<!DOCTYPE html>
<html lang="mr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sumeet Elko - Advanced Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <style>
        :root { --blue: #1e3a8a; --accent: #3b82f6; --green: #10b981; }
        body { font-family: 'Segoe UI', sans-serif; background: #f1f5f9; margin: 0; padding: 0; touch-action: pan-y; }
        
        .header { 
            background: var(--blue); color: white; padding: 10px; 
            position: sticky; top: 0; z-index: 1000; text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .btn-panel { display: flex; justify-content: center; gap: 8px; margin-top: 8px; flex-wrap: wrap; }
        .btn { padding: 12px 18px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; color: white; transition: 0.2s; font-size: 14px; }
        .btn-add { background: var(--accent); }
        .btn-intro { background: #f59e0b; }
        .btn-pdf { background: var(--green); flex: 1; min-width: 140px; }
        .btn-jpg { background: #6366f1; flex: 1; min-width: 140px; }
        .btn-del { background: #ef4444; }

        .quality-panel { background: rgba(255,255,255,0.1); padding: 5px; border-radius: 8px; margin-top: 10px; display: flex; align-items: center; justify-content: center; gap: 10px; font-size: 12px; }

        #container { 
            padding: 20px 10px; display: flex; flex-direction: column; 
            align-items: center; gap: 30px; 
            transform: scale(0.38); 
            transform-origin: top center;
        }

        @media (min-width: 1000px) { #container { transform: scale(1); } }

        .slide {
            width: 960px; height: 540px;
            background-image: url('./bg.jpg'); /* ‡§§‡•Å‡§Æ‡§ö‡•Ä ‡§á‡§Æ‡•á‡§ú ‡§á‡§•‡•á bg.jpg ‡§®‡§æ‡§µ‡§æ‡§®‡•á ‡§Ö‡§∏‡§æ‡§µ‡•Ä */
            background-size: 100% 100%;
            background-repeat: no-repeat;
            background-color: white;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .slide-counter { position: absolute; bottom: 10px; right: 20px; background: rgba(0,0,0,0.5); color: white; padding: 5px 15px; border-radius: 20px; font-size: 14px; }
        .intro-area { position: absolute; left: 70px; top: 35%; width: 550px; text-align: left; }
        .main-t { font-family: 'Impact', sans-serif; font-size: 70px; color: var(--blue); outline: none; text-transform: uppercase; line-height: 1; }

        .photo-grid { display: flex; width: 88%; height: 65%; gap: 20px; position: absolute; top: 100px; left: 6%; }
        .photo-item { flex: 1; height: 100%; border: 5px solid white; box-shadow: 0 5px 15px rgba(0,0,0,0.1); position: relative; overflow: hidden; background: #eee; }
        .photo-item img { width: 100%; height: 100%; object-fit: fill; pointer-events: none; }

        .text-overlay { position: absolute; bottom: 15px; left: 15px; background: rgba(0,0,0,0.8); color: white; padding: 8px 20px; font-size: 22px; border-radius: 4px; font-weight: bold; display: none; text-transform: uppercase; }

        .label-selector { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border-radius: 12px; box-shadow: 0 5px 35px rgba(0,0,0,0.5); display: none; flex-direction: column; gap: 15px; z-index: 200; }
        .select-btn { background: #333; color: white; border: none; padding: 15px 30px; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 20px; }

        .slide-ctrl { position: absolute; top: 10px; right: 10px; display: flex; gap: 10px; z-index: 100; }
        .photo-actions { position: absolute; top: 10px; right: 10px; display: flex; gap: 8px; }
        .mini-btn { font-size: 16px; padding: 8px 12px; background: #333; color: white; border: none; cursor: pointer; border-radius: 6px; }
    </style>
</head>
<body>

<div class="header">
    <h3 style="margin:0;">Sumeet Elko - Advanced Generator</h3>
    <div class="btn-panel">
        <input type="file" id="files" accept="image/*" multiple style="display:none" onchange="createPhotoSlides()">
        <button class="btn btn-add" onclick="document.getElementById('files').click()">üì∑ Generate Report</button>
        <button class="btn btn-intro" onclick="addIntro()">üìÑ Add Intro</button>
        <button class="btn btn-pdf" onclick="saveAsPDF()">üì• PDF</button>
        <button class="btn btn-jpg" onclick="saveAsJPG()">üñºÔ∏è JPG</button>
    </div>
    
    <div class="quality-panel">
        Quality: 
        <select id="qualitySelect" style="border-radius: 4px; padding: 2px;">
            <option value="1">Low</option>
            <option value="1.5" selected>Medium</option>
            <option value="2.5">High</option>
        </select>
    </div>
</div>

<div id="container"></div>

<script>
    const container = document.getElementById('container');
    new Sortable(container, { animation: 150, handle: '.slide', delay: 200, delayOnTouchOnly: true, onEnd: updateSlideNumbers });

    window.onload = () => addIntro();

    function updateSlideNumbers() {
        const slides = document.querySelectorAll('.slide');
        slides.forEach((slide, index) => {
            let counter = slide.querySelector('.slide-counter');
            if (counter) counter.innerText = `Slide ${index + 1}`;
        });
    }

    function addIntro() {
        const div = document.createElement('div');
        div.className = 'slide';
        div.innerHTML = `
            <div class="slide-ctrl"><button class="btn btn-del" style="font-size:30px; padding:10px 20px;" onclick="this.closest('.slide').remove(); updateSlideNumbers();">X</button></div>
            <div class="intro-area">
                <div class="main-t" contenteditable="true" id="reportTitle">DEEP CLEANING DRIVE</div>
                <div style="font-size:24px; font-weight:bold; color:#444;" contenteditable="true">Maintaining Hygiene, Ensuring Safety</div>
            </div>
            <div class="slide-counter">Slide</div>
        `;
        container.appendChild(div);
        updateSlideNumbers();
    }

    async function createPhotoSlides() {
        const files = document.getElementById('files').files;
        if (files.length === 0) return;
        for (let i = 0; i < files.length; i += 2) {
            const div = document.createElement('div');
            div.className = 'slide';
            const grid = document.createElement('div');
            grid.className = 'photo-grid';
            await loadToGrid(files[i], grid);
            if (files[i+1]) await loadToGrid(files[i+1], grid);
            div.innerHTML = `<div class="slide-ctrl"><button class="btn btn-del" style="font-size:30px; padding:10px 20px;" onclick="this.closest('.slide').remove(); updateSlideNumbers();">X</button></div><div class="slide-counter">Slide</div>`;
            div.appendChild(grid);
            container.appendChild(div);
            new Sortable(grid, { group: 'shared-photos', animation: 200, delay: 200, delayOnTouchOnly: true });
        }
        updateSlideNumbers();
    }

    function loadToGrid(file, parent) {
        return new Promise((res) => {
            const r = new FileReader();
            r.onload = (e) => {
                const item = document.createElement('div');
                item.className = 'photo-item';
                item.innerHTML = `<img src="${e.target.result}"><div class="text-overlay">BEFORE</div><div class="label-selector"><button class="select-btn" onclick="setLabel(this, 'BEFORE')">BEFORE</button><button class="select-btn" onclick="setLabel(this, 'AFTER')">AFTER</button><button class="select-btn" style="background:#ef4444" onclick="closeSelector(this)">CLOSE</button></div><div class="photo-actions"><button class="mini-btn" onclick="openSelector(this)">üè∑Ô∏è Label</button><button class="mini-btn" style="background:red;" onclick="this.closest('.photo-item').remove()">X</button></div>`;
                parent.appendChild(item);
                res();
            };
            r.readAsDataURL(file);
        });
    }

    function openSelector(btn) { btn.closest('.photo-item').querySelector('.label-selector').style.display = 'flex'; }
    function closeSelector(btn) { btn.closest('.label-selector').style.display = 'none'; }
    function setLabel(btn, text) { const item = btn.closest('.photo-item'); const overlay = item.querySelector('.text-overlay'); overlay.innerText = text; overlay.style.display = 'block'; item.querySelector('.label-selector').style.display = 'none'; }

    async function saveAsPDF() {
        const slides = document.querySelectorAll('.slide');
        if (slides.length === 0) return alert("‡§∏‡•ç‡§≤‡§æ‡§à‡§°‡•ç‡§∏ ‡§§‡§Ø‡§æ‡§∞ ‡§ï‡§∞‡§æ!");
        const quality = parseFloat(document.getElementById('qualitySelect').value);
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF('l', 'px', [960, 540]);
        for (let i = 0; i < slides.length; i++) {
            slides[i].querySelectorAll('.slide-ctrl, .photo-actions, .label-selector, .slide-counter').forEach(el => el.style.visibility = 'hidden');
            const canvas = await html2canvas(slides[i], { scale: quality, useCORS: true, logging: false });
            slides[i].querySelectorAll('.slide-ctrl, .photo-actions, .label-selector, .slide-counter').forEach(el => el.style.visibility = 'visible');
            if (i > 0) doc.addPage();
            doc.addImage(canvas.toDataURL('image/jpeg', 0.85), 'JPEG', 0, 0, 960, 540);
        }
        const title = document.getElementById('reportTitle').innerText.trim().replace(/\s+/g, '_');
        const date = new Date().toLocaleDateString('en-GB').replace(/\//g, '-');
        doc.save(`${title}_${date}.pdf`);
    }

    async function saveAsJPG() {
        const slides = document.querySelectorAll('.slide');
        if (slides.length === 0) return alert("‡§∏‡•ç‡§≤‡§æ‡§à‡§°‡•ç‡§∏ ‡§§‡§Ø‡§æ‡§∞ ‡§ï‡§∞‡§æ!");
        const quality = parseFloat(document.getElementById('qualitySelect').value);
        for (let i = 0; i < slides.length; i++) {
            slides[i].querySelectorAll('.slide-ctrl, .photo-actions, .label-selector, .slide-counter').forEach(el => el.style.visibility = 'hidden');
            const canvas = await html2canvas(slides[i], { scale: quality, useCORS: true, logging: false });
            slides[i].querySelectorAll('.slide-ctrl, .photo-actions, .label-selector, .slide-counter').forEach(el => el.style.visibility = 'visible');
            const link = document.createElement('a');
            link.download = `Slide_${i+1}.jpg`;
            link.href = canvas.toDataURL('image/jpeg', 0.9);
            link.click();
        }
    }
</script>
</body>
</html>
